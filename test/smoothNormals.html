<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script src="../src/mat3.js"></script>
	<script src="../src/mat4.js"></script>
	<script src="../src/buffer.js"></script>
	<script src="../src/plane.js"></script>
	<script src="../src/sphere.js"></script>
	<script src="../src/smoothNormals.js"></script>
</head>
<body>
	<canvas id="test" width="800" height="450"></canvas>
	<script>

		var originX = 400;
		var originY = 225;


		var renderVertices = function(ctx, vertices) {
			ctx.fillStyle = "#000";
			var length = vertices.length;
			var stride = vertices.stride;
			for(var i = 0; i<length; i++) {
				var vx = vertices.get(i, 0);
				var vy = vertices.get(i, 1);
				var vz = vertices.get(i, 2);

				if(vz < 0) {
        			var sx = originX + vx * originX / vz;
        			var sy = originY + vy * originY / vz;

					ctx.fillRect(sx - 1, sy - 1, 2, 2);
				}
			}
		};


		var vertices = geom.buffer(3);
		var indices = geom.buffer(3);

		geom.sphere(vertices, 0, indices, 50);

		var context = document.getElementById("test").getContext("2d");
		

		var view = geom.mat4();
		var camera = geom.mat4();
		var projection = geom.mat4();
		projection.perspective(60 * Math.PI / 180, originX / originY, 1, 1000);

		var output = vertices.clone();

		var counter = 0;

		var update = function() {
			counter++;


			view.identity();
			view.rotateX(counter * 0.01);
			view.rotateY(counter * 0.02);
			view.rotateZ(counter * 0.03);
			

			camera.identity();
			camera.translate(0, 0, -1);
			camera.invert();


			var test = geom.mat4();
			test.concat(view);
			test.concat(camera);
			test.concat(projection);
			
			
			test.transform(vertices, 0, output, 0);
			

			context.fillStyle = "#999";
			context.fillRect(0, 0, context.canvas.width, context.canvas.height);
			
			renderVertices(context, output);

			requestAnimationFrame(update);
		};
		update();


	</script>
</body>
</html>